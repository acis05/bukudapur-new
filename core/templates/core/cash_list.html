{% extends "core/base.html" %}
{% load currency %}
{% block title %}Cash Flow — BukuDapur MBG{% endblock %}

{% block content %}
<div class="cardx p-4">
  <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
    <div>
      <div class="h3 mb-1">Cash Flow</div>
      <div class="muted">Kontrak: <b>{{ contract.name }}</b></div>
      <div class="muted">Catat pemasukan & pengeluaran kas (di luar penjualan harian bila perlu).</div>
    </div>

    <div class="d-flex gap-2">
      <a class="btn btn-ghost" href="{% url 'dashboard' %}">Kembali</a>
      <a class="btn btn-accent" href="{% url 'cash_create' %}">+ Tambah Cash</a>
    </div>
  </div>

  <div class="row g-3 mt-3">
    <div class="col-md-4">
      <div class="cardx p-3">
        <div class="muted small">Total Masuk</div>
        <div class="h4 m-0">{{ total_in|rupiah }}</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="cardx p-3">
        <div class="muted small">Total Keluar</div>
        <div class="h4 m-0">{{ total_out|rupiah }}</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="cardx p-3">
        <div class="muted small">Net Cash</div>
        <div class="h4 m-0">{{ net_cash|rupiah }}</div>
      </div>
    </div>
  </div>

  <div class="table-responsive mt-3">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th style="min-width:110px;">Tanggal</th>
          <th style="min-width:120px;">Kategori</th>
          <th>Catatan</th>
          <th class="text-end" style="min-width:120px;">Masuk</th>
          <th class="text-end" style="min-width:120px;">Keluar</th>
          <th class="text-end" style="min-width:120px;">Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for e in entries %}
          <tr>
            <td>{{ e.date|date:"d M Y" }}</td>
            <td>{{ e.category }}</td>
            <td class="muted">{{ e.notes|default:"-" }}</td>

            <td class="text-end">
              {% if e.flow == "IN" %}<b>{{ e.amount|rupiah }}</b>{% else %}-{% endif %}
            </td>
            <td class="text-end">
              {% if e.flow == "OUT" %}<b>{{ e.amount|rupiah }}</b>{% else %}-{% endif %}
            </td>

            <td class="text-end">
              <a class="btn btn-sm btn-nav" href="{% url 'cash_edit' e.id %}">Edit</a>
              <a class="btn btn-sm btn-ghost" href="{% url 'cash_delete' e.id %}"
                 onclick="return confirm('Hapus transaksi cash ini?');">Hapus</a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="muted">Belum ada transaksi cash.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
  /* Biar tabel nyaman di HP: kalau sempit bisa scroll horizontal tapi tidak “maksa ke kanan” */
  .table-responsive{ -webkit-overflow-scrolling: touch; }
</style>
{% endblock %}