{% extends "core/base.html" %}
{% block title %}{% if is_edit %}Edit Cash{% else %}Tambah Cash{% endif %} â€” BukuDapur MBG{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-7">
    <div class="cardx p-4">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="h4 mb-1">{% if is_edit %}Edit Cash{% else %}Tambah Cash{% endif %}</div>
          {% if contract %}<div class="muted">Kontrak: <b>{{ contract.name }}</b></div>{% endif %}
          <div class="muted small">Gunakan untuk pemasukan/pengeluaran kas selain penjualan harian (opsional).</div>
        </div>
        <a class="btn btn-ghost" href="{% url 'cash_list' %}">Kembali</a>
      </div>

      {% if form.errors %}
        <div class="alert alert-warning mt-3">
          <div class="fw-semibold mb-1">Form belum valid:</div>
          {{ form.errors }}
        </div>
      {% endif %}

      <form method="post" class="mt-3" id="cashForm">
        {% csrf_token %}

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Tanggal</label>
            {{ form.date }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Tipe</label>
            {{ form.flow }}
            <div class="small muted mt-1">Masuk = uang masuk, Keluar = uang keluar.</div>
          </div>

          <div class="col-md-6">
            <label class="form-label">Kategori</label>
            {{ form.category }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Nominal</label>
            {{ form.amount }}
            <div class="small muted mt-1">Isi angka saja (contoh: 150000).</div>
          </div>

          <div class="col-md-12">
            <label class="form-label">Catatan (opsional)</label>
            {{ form.notes }}
          </div>
        </div>

        <div class="cardx p-3 mt-3" style="border-radius:16px;">
          <div class="small muted">Preview</div>
          <div class="d-flex justify-content-between mt-1">
            <div>Total</div>
            <div class="fw-semibold" id="pvCash">Rp 0</div>
          </div>
        </div>

        <div class="mt-4 d-flex gap-2">
          <button class="btn btn-accent" type="submit">Simpan</button>
          <a class="btn btn-ghost" href="{% url 'cash_list' %}">Batal</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  (function(){
    const elAmount = document.getElementById("id_amount");
    const pvCash = document.getElementById("pvCash");

    function n(v){ return Number(String(v||"0").replace(",", ".")) || 0; }
    function fmt(x){
      try { return new Intl.NumberFormat("id-ID").format(Math.round(x)); }
      catch(e){ return String(x); }
    }
    function recalc(){
      const amount = n(elAmount ? elAmount.value : 0);
      pvCash.textContent = "Rp " + fmt(amount);
    }

    if (elAmount) elAmount.addEventListener("input", recalc);
    recalc();
  })();
</script>
{% endblock %}