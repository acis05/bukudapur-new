{% extends "core/base.html" %}
{% load currency %}
{% block title %}{% if is_edit %}Edit Cash{% else %}Tambah Cash{% endif %} â€” BukuDapur MBG{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-7">
    <div class="cardx p-4">
      <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
        <div>
          <div class="h4 mb-1">{% if is_edit %}Edit Cash{% else %}Tambah Cash{% endif %}</div>
          <div class="muted">Kontrak: <b>{{ contract.name }}</b></div>
          <div class="muted small">Gunakan untuk pemasukan/pengeluaran kas selain penjualan harian bila perlu.</div>
        </div>
        <a class="btn btn-ghost" href="{% url 'cash_list' %}">Kembali</a>
      </div>

      {% if form.errors %}
        <div class="alert alert-warning mt-3">
          <div class="fw-semibold mb-1">Form belum valid:</div>
          {{ form.errors }}
        </div>
      {% endif %}

      <form method="post" class="mt-3" id="cashForm">
        {% csrf_token %}

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Tanggal</label>
            {{ form.date }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Tipe</label>
            <div class="muted small mb-1">Masuk = uang masuk, Keluar = uang keluar.</div>
            {{ form.flow }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Kategori</label>
            {{ form.category }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Nominal</label>
            <div class="muted small mb-1">Isi angka saja (contoh: 150000).</div>
            {{ form.amount }}
          </div>

          <div class="col-12">
            <label class="form-label">Catatan (opsional)</label>
            {{ form.notes }}
          </div>
        </div>

        <div class="mt-4 d-flex gap-2">
          <button class="btn btn-accent" type="submit">Simpan</button>
          <a class="btn btn-outline-light" href="{% url 'cash_list' %}">Lihat Cash Flow</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Pastikan select "flow" benar-benar bisa dipilih (kadang widget ke-render tanpa class)
  (function(){
    const elFlow = document.getElementById("id_flow");
    if (elFlow) elFlow.classList.add("form-select");
    const ids = ["id_date","id_category","id_amount","id_notes"];
    ids.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      if (el.tagName === "SELECT") el.classList.add("form-select");
      else el.classList.add("form-control");
    });
  })();
</script>
{% endblock %}